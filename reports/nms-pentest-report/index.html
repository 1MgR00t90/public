<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XSS Penetration Test Report - TRUE FULL DARK</title>
  <style>
    html, body {
      background-color: #000 !important;
      color: #eee;
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
    .container {
      width: 100%;
      max-width: none;
      margin: 0;
      padding: 40px;
      background-color: #000 !important;
    }
    /* Override nested/pandoc-inserted html/body rules that force a narrow
       centered column. The pandoc fragment inside this file includes its
       own `html` and `body` tags which browsers treat as elements and
       their global rules can narrow the layout. Target those nested
       elements inside the .container and neutralize the constraining
       styles. */
    .container body,
    .container html {
      max-width: none !important;
      margin: 0 !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
      background-color: transparent !important;
      color: inherit !important;
      width: auto !important;
    }
    pre, code {
      background-color: #1a1a1a;
      color: #0f0;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
    }
    th, td {
      border: 1px solid #555;
      padding: 8px;
    }
    blockquote {
      border-left: 4px solid #999;
      padding-left: 12px;
      color: #ccc;
    }
    a {
      color: #4fc3f7;
    }
    img {
      max-width: 100%;
      border: 1px solid #444;
      border-radius: 4px;
      display: block;
      margin: 2rem auto;
    }
    figure {
      text-align: center;
      margin: 2rem auto;
    }
    figcaption {
      margin-top: 0.5rem;
      font-style: italic;
      color: #999;
    }
    h1, h2, h3, h4 {
      color: #fff;
    }
    /* Merged/pandoc styles (scoped) - cleaned to avoid global body/html overrides */
    .pandoc-content {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #eee;
      background-color: transparent;
      padding: 50px 50px;
      max-width: none;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      .pandoc-content { font-size: 0.95em; padding: 1em; }
      .pandoc-content h1 { font-size: 1.8em; }
    }
    .pandoc-content p { margin: 1em 0; color: #ddd; }
    .pandoc-content a { color: #4fc3f7; }
    .pandoc-content blockquote { margin: 1em 0 1em 1.7em; padding-left: 1em; border-left: 2px solid #444; color: #bfbfbf; }
    .pandoc-content code { font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace; font-size: 85%; background-color: #1a1a1a; color: #0f0; padding: 0.1em 0.25em; border-radius: 3px; }
    .pandoc-content pre { margin: 1em 0; overflow: auto; }
    .pandoc-content table { margin: 1em 0; border-collapse: collapse; width: 100%; }
  .pandoc-content th, .pandoc-content td { padding: 0.25em 0.5em; border: 1px solid #333; color: #ddd; }
  </style>
</head>
<body>
  <div class="container">
<div class="pandoc-content">
<h1 id="penetration-test-report-network-management-system-application-stored-reflected-xss-cross-site-scripting">Penetration Test Report: Network Management System application — Stored/Reflected XSS (cross-site scripting)</h1>
<h1 id="preface">Preface</h1>
<p>This report documents a <strong>Manual</strong> Web Application
pentest conducted with <strong>explicit permission</strong> from the
system owner. The target/scope of the assessment was a <strong>network
management system application</strong> developed using
<strong>ClaudeAI</strong>. The findings underscore the risks of
deploying AI-assisted or auto-generated systems without formal security
review, as such tools may introduce exploitable flaws if left
unchecked.</p>
<blockquote>
<p><strong>Disclaimer:</strong> This test was performed on a
<strong>development system</strong> solely for <strong>educational and
learning purposes</strong>. No production data or infrastructure was
affected. This report should not be misinterpreted as an indication of
vulnerabilities in any live or commercial system. All sensitive details
have been removed or altered. No real-world system or data is
disclosed.</p>
<p>As a security researcher without full-time development experience, and considering the application's AI-assisted development nature, although the testing and reporting was done manually, the "remediation recommendations" section in this report was researched and formulated with the assistance of AI to ensure technically accurate information.</p>
</blockquote>
<h2 id="system-profile">System Profile</h2>
<blockquote>
<p>The system utilizing both <strong>JavaScript</strong> on the frontend
and <strong>Flask/Python</strong> on the backend; integrates with
multiple <strong>network infrastructure</strong>, and
<strong>cloud-based network APIs</strong>. It aggregates this data into
dashboards designed for <strong>Network Operations Centers
(NOC)</strong> visibilty.</p>
</blockquote>
<p><em>Application Flow</em></p>
<pre><code>[ User Browser ]
      |
      |  (1) jQuery AJAX Request
      v
[ Frontend JavaScript ]
      |
      |  → /api/get-firewall-rules
      v
[ Flask Route (Python) ]
      |
      |  (2) Secure API Call to External System 
      v
[ External API (cloud-based network firewall) ]
      |
      |  (3) Response with rule data
      v
[ Flask Backend ]
      |
      |  (4) JSON response to frontend
      v
[ Frontend Renders Dashboard ]</code></pre>
<h2 id="affected-path-endpoint">Affected Path &amp; Endpoint</h2>
<ul>
<li><strong>Path</strong>: <code>/firewall</code></li>
<li><strong>Api-Endpoint</strong>:
<code>/api/firewall/template/{template}/update</code></li>
</ul>
<h2 id="vulnerability-type">Vulnerability Type</h2>
<ul>
<li>Stored (Persistent) XSS</li>
<li>Reflected XSS</li>
<li>HTML Injection</li>
</ul>
<p>The application accepts and stores unsanitized user input in the
<strong>comment field</strong> of the cloud-based network firewall rule
editor. The payload is both:</p>
<ul>
<li><strong>Reflected immediately</strong> in the HTTP response
(Reflected XSS)</li>
<li><strong>Persisted</strong> and displayed to future users (Stored
XSS)</li>
</ul>
<p>Additionally, basic HTML tags such as <code>&lt;a&gt;</code> are
rendered unsanitized, enabling phishing attacks through malicious
links.</p>
<h2 id="enumeration">Enumeration</h2>

<p><em>Initial Approach:</em> Began with standard reconnaissance using nmap. Given the web application scope, transitioned to web-focused tools. Nikto scan was attempted but provided limited useful information about the application architecture.</p>

<table>
<thead>
<tr class="header">
<th>Technologies Identified</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Frontend</strong>: JavaScript (jQuery identified in source code)</td>
</tr>
<tr class="even">
<td><strong>Backend</strong>: Flask (Python) - identified via  wappalyzer andserver headers</td>
</tr>
<tr class="odd">
<td><strong>APIs Consumed</strong>: cloud-based network firewall API</td>
</tr>
</tbody>
</table>

<p><em>Note:</em> Potentially outdated jQuery version detected. Further investigation of version-specific vulnerabilities pending.</p>

<table>
<thead>
<tr class="header">
<th>Tools Used</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Burp Suite pro</td>
</tr>
<tr class="even">
<td>Wappalyzer</td>
</tr>
<tr class="odd">
<td>Browser DevTools</td>
</tr>
<tr class="even">
</tr>
</tbody>
</table>
<blockquote>
<p><em>Browsing the system notice that the nms(network management
system) homepage has multiple tiles that display information from
different network systems. Using wappalyzer it was deduced that the
system is running a few javascript libraries and flask web
framework.</em></p>
</blockquote>
<figure>
<img src="images/enumeration-wappalyzer.png" alt="Wappalyzer Output" />
<figcaption aria-hidden="true">Wappalyzer Output</figcaption>
</figure>
<blockquote>
<p><em>Focusing on the site paths that allowed any user input I landed
on the cloud-based network firewall tile or the <code>/firewall</code>
path of the system</em>.</p>
</blockquote>
<figure>
<img src="images/nms-frontpage.png" alt="nms-frontpage" />
<figcaption aria-hidden="true">nms-frontpage</figcaption>
</figure>
<h2 id="proof-of-concept">Proof of Concept</h2>
<h3 id="reflected-xss">1. Reflected XSS</h3>

<p><em>Discovery Process:</em> Started with basic input validation testing using special characters. Upon noticing &lt; and &gt; characters were not escaped, proceeded with:</p>

<ul>
<li>Initial test: <code>&lt;h1&gt;test&lt;/h1&gt;</code> - confirmed HTML injection possibility</li>
<li>Final test: <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> - vulnerability confirmed</li>
</ul>

<p><em>Additional observation:</em> The application implements partial payload filtering, but allows <code>&lt;script&gt;</code> tags through. Further research needed on filter bypass techniques.</p>

<figure>
<img src="images/xss%20injection-yt-burpsuite.png"
alt="Reflected XSS Injection" />
<figcaption aria-hidden="true">Reflected XSS Injection captured via Burp Suite proxy intercept</figcaption>
</figure>
<h3 id="stored-xss-persistent">2. Stored XSS (Persistent)</h3>
<ul>
<li>The same payload, once saved, is displayed to all users when they
view the comment.</li>
<li>Increases risk by automatically impacting any user who views the
malicious entry.</li>
</ul>
<figure>
<img src="images/xss-pop.png" alt="Stored XSS Popup" />
<figcaption aria-hidden="true">Stored XSS Popup</figcaption>
</figure>
<h3 id="html-injection-for-external-links">3. HTML Injection for
External Links</h3>
<ul>
<li>Payload:
<code>&lt;a href="https://evil.com"&gt;Click me&lt;/a&gt;</code></li>
<li>Behavior: This link gets rendered and becomes clickable, allowing
redirection to phishing sites or attacker-controlled domains.</li>
</ul>
<h2 id="payload-execution-sequence">Payload Execution Sequence</h2>
<p><em>An attacker submits a malicious payload to the comment field of
the application. This payload is then stored in the backend database
without proper sanitization. When the frontend retrieves and renders the
comment, it does so using an unsafe template literal, injecting the raw
content directly into the DOM whenever a rule is created or in this
case; updated. As a result, any user who views the rule table in the
interface will unknowingly trigger the execution of the attacker’s
payload in their browser</em></p>
<p>Example of Vulnerable Code: <img src="images/vuln-code.png"
alt="vuln-code" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript">function createRuleRow(rule) {
  return `&lt;td&gt;${rule.comment || ''}&lt;/td&gt;`; // 🚨 No sanitization
}</code></pre></div>

<p><strong>JavaScript Sink Analysis:</strong></p>
<figure>
<img src="images/js-sink.png" alt="JavaScript element.innerHTML sink vulnerability" />
<figcaption>JavaScript element.innerHTML sink point allowing XSS exploitation</figcaption>
</figure>
<p>The vulnerability stems from using element.innerHTML as a JavaScript sink point. This DOM property is particularly dangerous because:</p>
<ul>
<li>When element.innerHTML is set, the browser parses the new content as HTML, including any embedded <code>&lt;script&gt;</code> tags or JavaScript events</li>
<li>Unlike textContent, innerHTML processes HTML entities and executes any JavaScript found in attributes like onclick, onmouseover, etc.</li>
<li>The browser's HTML parser runs immediately when innerHTML is set, making it an active sink that can execute malicious code instantly</li>
</ul>
<p>In this case, rule comments flow directly into element.innerHTML without sanitization, creating a critical XSS vector. An attacker can inject payloads like <code>&lt;img src=x onerror=alert(1)&gt;</code> that execute immediately when the comment is displayed.</p>

<h2 id="impact">Impact</h2>
<ul>
<li>Credential theft via phishing links</li>
<li>Session hijacking through JavaScript execution</li>
<li>CSRF or forced actions using stored scripts</li>
<li>Redirects to attacker-controlled domains</li>
</ul>
<h2 id="recommendations-remediation">Recommendations &amp; Remediation</h2>
<h3 id="input-validation">Input Validation</h3>
<ul>
<li>Validate all user-supplied input on the server side.</li>
<li>Disallow any unexpected or special characters in fields that should
not accept HTML or JavaScript.</li>
<li>Enforce strong schema validation (e.g., using JSON schema or backend
validators).</li>
</ul>
<h3 id="output-encoding-escaping">Output Encoding / Escaping</h3>
<p><strong>Best Practice:</strong> Avoid using element.innerHTML entirely. Instead, use safer alternatives:</p>
<ul>
<li>Use element.textContent for text-only content</li>
<li>Use document.createElement() and appendChild() for DOM manipulation</li>
<li>If HTML strings must be used, implement strict escaping:</li>
</ul>

<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript">function escapeHtml(text) {
  return text
    .replace(/&amp;/g, "&amp;amp;")
    .replace(/&lt;/g, "&amp;lt;")
    .replace(/&gt;/g, "&amp;gt;")
    .replace(/&quot;/g, "&amp;quot;")
    .replace(/&#39;/g, "&amp;#x27;");
}</code></pre></div>

<p><strong>Safe Implementation:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript">// Instead of innerHTML, use:
function createRuleRow(rule) {
  const td = document.createElement('td');
  td.textContent = rule.comment || '';
  return td;
}

// Or if escaping HTML is required:
function createRuleRowWithEscaping(rule) {
  return `&lt;td&gt;${escapeHtml(rule.comment || '')}&lt;/td&gt;`;
}</code></pre></div>
<h3 id="content-sanitization">Content Sanitization</h3>
<p>If your application <strong>needs to allow limited HTML</strong>, do
the following:</p>
<ul>
<li>Use a library like <strong>DOMPurify</strong> (client-side) or
<strong>Bleach</strong> (Python) or <strong>OWASP Java HTML
Sanitizer</strong> (Java).</li>
<li>Strip or encode any script tags, inline event handlers (e.g.,
<code>onclick</code>), and untrusted attributes.</li>
<li>Whitelist only safe tags and attributes.</li>
</ul>
<p><strong>Recommended Allowed Tags:</strong> - <code>&lt;b&gt;</code>,
<code>&lt;i&gt;</code>, <code>&lt;u&gt;</code>,
<code>&lt;strong&gt;</code>, <code>&lt;em&gt;</code>,
<code>&lt;a href target rel&gt;</code></p>
<p><strong>Recommended Allowed Attributes:</strong> - <code>href</code>,
<code>rel</code>, <code>target</code> (for links) - Always add
<code>rel="noopener noreferrer"</code> to <code>&lt;a&gt;</code> tags
that open in a new tab.</p>
<h3 id="security-headers">Security Headers</h3>
<p>Set the following HTTP headers globally:</p>
<pre><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;;
X-Content-Type-Options: nosniff
X-Frame-Options: DENY</code></pre>
<ul>
<li>Set cookies with <code>HttpOnly</code>, <code>Secure</code>, and
<code>SameSite=Strict</code>.</li>
</ul>
<h2 id="cvss-score-estimate">CVSS Score Estimate</h2>
<table>
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Attack Vector</td>
<td>Network</td>
</tr>
<tr class="even">
<td>Attack Complexity</td>
<td>Low</td>
</tr>
<tr class="odd">
<td>Privileges Required</td>
<td>Low</td>
</tr>
<tr class="even">
<td>User Interaction</td>
<td>Required</td>
</tr>
<tr class="odd">
<td>Confidentiality Impact</td>
<td>High</td>
</tr>
<tr class="even">
<td>Integrity Impact</td>
<td>High</td>
</tr>
<tr class="odd">
<td>Availability Impact</td>
<td>Low</td>
</tr>
<tr class="even">
<td><strong>Base Score (est.)</strong></td>
<td>8.2 - 9.0</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Use the CVSS Calculator: https://www.first.org/cvss/calculator/</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>The application was found to reflect and persist unsanitized user
input in HTML contexts, resulting in both reflected and stored XSS
vulnerabilities. Importantly, the vulnerability did not originate from
the backend cloud-based network firewall API itself, but rather from how
the application rendered data received from the API without proper
sanitization. Although the affected system was internal, it should still
be treated as high-risk potential due to the possibility of chained
attacks, lateral movement, and browser-based exploitation.</p>
<blockquote>
<p>The vulnerabilities were responsibly reported and remediated through
proper input sanitization, output encoding, and validation.</p>
</blockquote>
</div>

  </div>
</body>
</html>
